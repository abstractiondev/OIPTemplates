<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/Chart.js/0.2.0/Chart.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
</head>
<body>
<canvas id="myChart" width="600" height="400"></canvas>
<canvas id="myChart2" width="600" height="400"></canvas>
</body>

<script type="text/javascript">
    //Get context with jQuery - using jQuery's .get() method.
    var ctx = $("#myChart").get(0).getContext("2d");
    var pieCtx = $("#myChart2").get(0).getContext("2d");
    //This will get the first returned node in the jQuery collection.
    //var myNewChart = new Chart(ctx);

    $(function () {
        var fetchDatas = [
            "../../TheBall.CORE/UsageSummary/20131102_Hourly.json",
            "../../TheBall.CORE/UsageSummary/20131102_Detailed.json",
            //"../../AaltoGlobalImpact.OIP/AddressAndLocationCollection/MasterCollection.json",
            //"../../AaltoGlobalImpact.OIP/GroupContainer/default.json"
        ];
        $.each(fetchDatas, function(index, value) {
            fetchDatas[index] = $.ajax({ url: value, cache:false });
        });
        /*$.get("../../AaltoGlobalImpact.OIP/NodeSummaryContainer/default.json", function ()jsonObject) {*/
        $.when.apply($, fetchDatas).then(function() {
            var usageSummary = arguments[0][0];
            //var nodeSummary = arguments[0][0];
            //CurrNodeSummary = nodeSummary;
            //CurrLocations = arguments[1][0];
            //CurrGroupContainer = arguments[2][0];
            hourCPUTimes = [];
            networkBytes = [];
            var totalCPUms = 0;
            var totalNetworkBytes = 0;
            $.each(usageSummary.SummaryMonitoringItem.ProcessorUsages.CollectionContent, function(index, value) {
                hourCPUTimes.push(value.Milliseconds / 1000);
                totalCPUms += value.Milliseconds;
            });
            $.each(usageSummary.SummaryMonitoringItem.NetworkUsages.CollectionContent, function(index, value) {
                networkBytes.push(value.AmountOfBytes);
                totalNetworkBytes += value.AmountOfBytes;
            });
            var data = {
                labels : ["0:00","1:00","2:00","3:00","4:00","5:00","6:00",
                    "7:00","8:00","9:00","10:00","11:00","12:00",
                    "13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00",
                    "21:00","22:00","23:00"],
                datasets : [
                    {
                        fillColor : "rgba(220,220,220,0.5)",
                        strokeColor : "rgba(220,220,220,1)",
                        data : hourCPUTimes
                    },
                    {
                        fillColor : "rgba(151,187,205,0.5)",
                        strokeColor : "rgba(151,187,205,1)",
                        data : []
                    }
                ]
            }
            //options = {};
            new Chart(ctx).Bar(data);
            var totalDayMs = 86400000;
            var remainingMs = totalDayMs - totalCPUms;
            var pieData = [
                {
                    value: remainingMs,
                    color:"#F38630"
                },
                {
                    value : totalCPUms,
                    color : "#E0E4CC"
                }
            ];
            new Chart(pieCtx).Pie(pieData);

        });

    });

</script>
</html>